# درباره RelaySMS

## فهرست مطالب

- [تاریخچه و موارد استفاده](#تاریخچه-و-موارد-استفاده)
  - [تاریخچه](#تاریخچه)
  - [موارد استفاده](#موارد-استفاده)
- [بررسی فنی](#بررسی-فنی)
  - [اجزای اصلی نرم‌افزار](#اجزای-اصلی-نرم‌افزار)
- [مسیرهای پیش رو](#مسیرهای-پیش-رو)
- [سکوها](#سکوها)
- [پل‌ها](#پل‌ها)
- [کلاینت‌ها](#کلاینت‌ها)
- [کلاینت‌های درگاه](#کلاینت‌های-درگاه)
- [میزبانی شخصی](#میزبانی-شخصی)
- [درس‌های آموخته‌شده](#درس‌های-آموخته‌شده)

---

## تاریخچه و موارد استفاده

### تاریخچه

پروژه SMSWithoutBorders در سال ۲۰۲۱ آغاز شد و بعداً در سال ۲۰۲۲ به ابزاری برای مقابله با قطع اینترنت تبدیل شد، با کمک یک گرنت از Internews و بودجه ادامه‌دار از Open Technology Fund (OTF).

SMSWithoutBorders با یک کلاینت اندروید به نام SWOB (مخفف SMSWithoutBorders) آغاز شد که بعداً به RelaySMS تغییر نام داد. از سال ۲۰۲۳، ما شروع به توسعه DekuSMS کردیم - یک اپلیکیشن پیام‌رسانی SMS با پشتیبانی از رمزگذاری سرتاسری.

در آن زمان از Raspberry Pi و دانگل‌های USB برای فوروارد SMS در RelaySMS استفاده می‌کردیم؛ که به دلیل مشکلات انرژی و لجستیکی ناکارآمد بود. زمان از کار افتادن سرویس بسیار بالا بود و باعث شد استفاده از سرویس پایین و کند باشد.

بعداً فوروارد کردن به DekuSMS منتقل شد که عملکرد بهتری داشت و زمان از کار افتادن را بیش از ۹۰٪ کاهش داد. این باعث بهبود تجربه کاربران جدید و افزایش استفاده از سرویس شد.

تجربه ما در توسعه RelaySMS ناشی از زندگی در محیطی است که به دلایل سیاسی با قطع اینترنت مواجه بود. این قطع اینترنت بیش از ۹۰ روز در دو منطقه کشور طول کشید و رکورد آفریقایی ایجاد کرد. این اتفاق در سال ۲۰۱۶ در کامرون رخ داد.

### موارد استفاده

RelaySMS یک پلتفرم ارتباطی متن‌باز است که هدف آن ارسال پیام از طریق اینترنت با استفاده از SMS است. این مورد در مناطقی که اتصال اینترنت فعال ندارند بسیار مفید است؛ معمولاً در مناطق دورافتاده و در دوره‌های ناآرامی.

به خوبی مشخص شده که دولت‌ها اینترنت را به عنوان سلاح علیه مردم خود به کار می‌گیرند و آن را به طور کامل (یا گاهی جزئی) قطع می‌کنند. این امر توانایی مردم برای دریافت اخبار و اطلاعات حیاتی را محدود می‌کند و همچنین تجارت و ارتباطات امن را دچار مشکل می‌کند. در این شرایط، ابزارهایی مانند VPN و برخی تکنیک‌های دور زدن اینترنت کار نمی‌کنند زیرا نیاز به دسترسی به اینترنت دارند.

در این شرایط است که ما RelaySMS را توسعه می‌دهیم. اگرچه می‌دانیم که گاهی اوقات پیامک‌ها در دوران ناآرامی مسدود می‌شوند، اما معمولاً سریع‌تر از اتصال اینترنت دوباره فعال می‌شوند؛ این ممکن است به این دلیل باشد که دشمنان هنوز پیامک را به عنوان یک مدل تهدید در نظر نگرفته‌اند (فراتر از ارتباط محلی فرد به فرد).

---
## تحلیل تکنولوژیک

RelaySMS می‌تواند به دو صورت استفاده شود: پل‌ها (Bridges) یا پلتفرم‌ها (جزئیات بیشتر در ادامه). فارغ از اینکه کدام حالت استفاده شود:

- محتوای پیام کاربر در دستگاه کاربر رمزگذاری می‌شود - با استفاده از الگوریتم Double Ratchet سیگنال برای امنیت آینده.
- پیام‌ها به یک کلاینت Gateway ارسال می‌شوند (احتمالاً یک دستگاه اندروید که DekuSMS را اجرا می‌کند). این دستگاه سپس پیام ورودی (هنوز رمزگذاری شده) را به یک سرور Gateway در فضای ابری منتقل می‌کند.
- سرور Gateway تعیین می‌کند که پیام برای کدام حالت است و آن را به یک سرور پل یا پلتفرم برای انتشار منتقل می‌کند.
- پیام سپس با کلیدهای دریافت شده از Vault (نرم‌افزار سرور مسئول ذخیره و حفاظت از اطلاعات کاربر) رمزگشایی می‌شود. پیام رمزگشایی شده سپس منتشر می‌شود.
- در مواردی که پیام در پلتفرم‌های آنلاین مانند Gmail منتشر می‌شود، کاربر یک پیامک دریافت می‌کند که وضعیت درخواست را تأیید می‌کند – یا با موفقیت منتشر شده یا انتشار آن ناموفق بوده است.

**توجه:** پیام‌های دریافت شده از پاسخ‌های Bridge به یک پیام اولیه ارسال شده از کلاینت هستند. این جلسات Double Ratchet را تکمیل می‌کند که به معنای تولید مجموعه جدیدی از کلیدها است (Ratcheting).

### اجزای نرم‌افزاری کلیدی

- کلاینت‌ها (اپلیکیشن‌های اندروید یا iOS)
- کلاینت‌های Gateway: دستگاه‌های اندروید که DekuSMS را اجرا می‌کنند
- سرور Gateway: نرم‌افزاری که تعیین می‌کند پیام‌ها را به چه کسی منتشر کند
- Bridges – جزئیات بیشتر در ادامه
- Platforms – جزئیات بیشتر در ادامه
- Vault – نرم‌افزار امنی که داده‌های حساس را به نمایندگی از کاربر ذخیره می‌کند، شامل کلیدهای امنیتی و توکن‌های انتشار آنلاین (جزئیات بیشتر درباره پلتفرم‌ها)

---

## مسیرهای قابل بررسی

در کوتاه مدت، ابزارهایی مانند RelaySMS می‌توانند برای ارتباط با پلتفرم‌های آنلاین استفاده شوند که آماده پخش اطلاعات ورودی به مشترکین هستند. این می‌تواند در کانال‌های پیام‌رسانی مانند گروه‌های WhatsApp، Signal یا Telegram انجام شود.

---

## پلتفرم‌ها

این اولین و اصلی‌ترین حالت ارتباطی برای RelaySMS است. این عملکرد نیاز دارد که کاربر دسترسی به پلتفرم‌های آنلاین خود را در یک سرور ابری که Vaultهای RelaySMS را اجرا می‌کند ذخیره کند. نوع دسترسی‌های ذخیره شده شامل توکن‌های OAuth2.0 (با scopes فقط برای انتشار) و توکن‌های حساب (برای پلتفرم‌هایی مانند Telegram) است. این توکن‌ها برای این طراحی شده‌اند که شخص ثالث بتواند به نمایندگی از کاربر عمل کند و scopes تعیین می‌کنند که شخص ثالث تا چه حد می‌تواند اقدام کند.

کاربر باید به شخص ثالث اعتماد کند تا این توکن‌ها را اعطا کند؛ زیرا ممکن است شخص ثالث بدون رضایت کاربر به نمایندگی از او عمل کند.

RelaySMS به کاربران آموزش می‌دهد که چگونه بررسی کنند آیا شخص ثالث به نمایندگی از آنها عمل کرده است فراتر از درخواست‌های انجام شده توسط خودشان. این استاندارد تقریباً در تمام پلتفرم‌ها است، زیرا scope اعطا شده توسط کاربر به سرویس اجازه نمی‌دهد که سوابق اقدامات انجام شده را تغییر دهد یا حذف کند.

مزایای استفاده از پلتفرم‌های آنلاین به این روش شامل عواملی مانند انسجام است که اعتماد را افزایش می‌دهد؛ گیرنده می‌داند فرستنده کیست. در مواردی مانند شبکه‌های اجتماعی، ممکن است کاربر دنبال‌کنندگان زیادی داشته باشد که از دریافت به‌روزرسانی زنده در حالی که کاربر آفلاین است بهره‌مند شوند. این دنبال‌کنندگان نمی‌توانند به حساب دیگری منتقل شوند و پیام باید دریافت شود. این همچنین برای گروه‌هایی که کاربر عضو آن‌هاست نیز صدق می‌کند.

کاربر باید این مراحل را زمانی انجام دهد که دسترسی به اینترنت دارد. توصیه می‌شود که این اقدامات در مراحل اولیه آماده‌سازی برای قطع اینترنت انجام شود. ما برخی راهنماها در این زمینه داریم و منابع بیشتری در ادامه ارائه شده است.

پلتفرم‌های پشتیبانی شده فعلی عبارتند از:

- Gmail
- Telegram
- Twitter (X)
- BlueSky
- Mastodon

---

## Bridges

این حالت انتشار با RelaySMS به عنوان حالت ثانویه اما بسیار مهم در نظر گرفته می‌شود. در مواردی که کاربر به اینترنت دسترسی ندارد تا پلتفرم‌های آنلاین خود را ذخیره کند، یا بخواهد اطلاعاتی ارسال کند بدون استفاده از حساب‌های اصلی خود، از bridges استفاده می‌کند.

Bridges با تبدیل شماره تلفن کاربر به یک آدرس ایمیل دائمی که قادر به ارسال و دریافت پیام است، کار می‌کنند. یک مثال از سناریو:

کاربری با شماره: +237123456789 یکی از کلاینت‌ها (اندروید یا iOS) را برای نوشتن و ارسال پیام استفاده می‌کند. پیام در دستگاه رمزگذاری شده و به یک کلاینت Gateway ارسال می‌شود که آن را به سرور Gateway می‌فرستد. سرور Gateway تشخیص می‌دهد که این پیام مربوط به bridge است و آن را به سرور bridge منتقل می‌کند. سرور bridge سپس یک آدرس ایمیل از شماره تلفن کاربر ایجاد کرده و کلیدهای عمومی همراه را به صورت امن در Vault ذخیره می‌کند. یک مثال از آدرس ایمیل برای این شماره: 237123456789@relaysms.me.

پیام کاربر با استفاده از این آدرس ایمیل به گیرندگان مورد نظر ارسال می‌شود. این یک مزیت بزرگ است اگر شماره تلفن کاربر قبلاً برای گیرنده شناخته شده باشد، زیرا اعتماد به مبدا پیام را افزایش می‌دهد.

در مواردی که گیرنده به پیام کاربر پاسخ دهد، پاسخ رمزگذاری شده و از طریق SMS به کاربر بازگردانده می‌شود. سپس کاربر می‌تواند پیام را از کلاینت RelaySMS خود رمزگشایی کند.

این حالت امکان ارتباط دو طرفه بین فرستنده و گیرنده را فراهم می‌کند. پس از ایجاد آدرس ایمیل، هر پیامی که به آن ارسال شود، رمزگذاری شده و از طریق SMS به کاربر فرستاده می‌شود.

[باید اطلاعات بیشتری در مورد صندوق ورودی آدرس ایمیل و نحوه ایمن نگه داشتن آن تا زمان ارسال پیام به کاربر اضافه شود]

---

## کلاینت‌ها

پشتیبانی اصلی RelaySMS شامل کلاینت‌های اندروید و iOS است. هر دو عملکردهای متفاوتی ارائه می‌دهند، با این تفاوت که کلاینت اندروید به‌روزرسانی‌ها را سریع‌تر از iOS دریافت می‌کند.

تمام کلاینت‌ها همان پروتکل‌های استاندارد توسعه یافته برای ارتباط با Vault و انتشار پیام‌ها را ادغام می‌کنند. استانداردهایی که هر کلاینت باید ادغام کند عبارتند از:

- ایجاد حساب کاربری در Vault
- ورود به حساب Vault
- ذخیره حساب‌ها در Vault برای پروتکل‌های زیر:
  - OAuth2.0 مانند Bluesky
  - احراز هویت مبتنی بر شماره تلفن مانند Telegram
  - انتشار اولین پیام‌ها با Bridges
  - انتشار پیام‌های بعدی با Bridges
  - انتشار پیام‌ها از پلتفرم‌های ذخیره‌شده
  - انتشار پیام‌ها از پلتفرم‌های ذخیره‌شده با استفاده از Device ID
  - ذخیره توکن‌ها روی دستگاه
  - انتشار با توکن‌های ذخیره شده روی دستگاه

مفاهیم معرفی شده در این بخش شامل:

- **Device ID:** یک توکن شناسایی قابل شناسایی است که هم روی Vault و هم روی کلاینت ذخیره می‌شود. این امکان را به کاربر می‌دهد تا بدون استفاده از شماره تلفن خود به عنوان شناسه اصلی، پیام‌ها را از طریق پلتفرم‌های ذخیره‌شده منتشر کند. این برای تلفن‌های دو سیم کارت مفید است، جایی که شماره‌ای که برای ارسال پیامک استفاده می‌شود ممکن است تغییر کند، اما تمام جزئیات لازم هنوز روی دستگاه موجود است. این گزینه اختیاری است و نباید به صورت پیش‌فرض فعال شود.

- **ذخیره توکن‌ها روی دستگاه:** توکن‌های کاربر (OAuth2.0 یا مبتنی بر شماره تلفن) عمدتاً به‌صورت ایمن روی Vault ذخیره می‌شوند. کلاینت‌ها می‌توانند درخواست کنند که این توکن‌ها از Vault به دستگاه منتقل شوند. سپس توکن‌ها هنگام انتشار به پیام اضافه می‌شوند. در صورت وجود refresh token (مکانیزم معمول با OAuth2.0)، توکن جدید از طریق SMS به دستگاه بازگردانده می‌شود.

کلاینت‌ها آزادند هر روشی از انتشار که برای عملکرد پروژه خود لازم دارند، پیاده‌سازی کنند.

کلاینت‌های پیش‌فرض به کاربر این امکان را می‌دهند که آن‌ها را به هر نمونه Vault که ترجیح می‌دهد، متصل کند – جزئیات بیشتر در مورد خود میزبانی. این نیاز دارد که کلاینت Gateway که برای انتشار استفاده می‌شود نیز به همان نمونه Vault اشاره کند، در غیر این صورت پیام‌ها در سمت سرور قابل رمزگشایی نخواهند بود.

از آنجایی که هر کلاینت می‌تواند متفاوت باشد، هر کلاینت باید کلاینت‌های خود را ارائه دهد. برای آموزش‌های پیش‌فرض ارائه شده توسط تیم RelaySMS، می‌توانید آن‌ها را در اینجا پیدا کنید [قرار دادن آموزش‌های RelaySMS].

---

## کلاینت‌های Gateway

کلاینت‌های Gateway دستگاه‌هایی هستند که قادر به دریافت پیامک‌های ورودی از کلاینت‌های RelaySMS هستند. کلاینت‌های Gateway می‌توانند روی دستگاه‌های اندروید یا لینوکس با مودم USB اجرا شوند. نمونه‌های پیش‌فرض RelaySMS از دستگاه‌های اندروید که DekuSMS را اجرا می‌کنند به عنوان کلاینت Gateway پیش‌فرض استفاده می‌کنند. با این حال، پروتکل‌ها برای تبدیل هر دریافت‌کننده‌ای به کلاینت Gateway شامل ارسال payload در فرمت JSON [قرار دادن مرجع] به یک نمونه cloud که سرور Gateway را اجرا می‌کند، می‌باشد.

چون کلاینت‌های Gateway کلیدها را با کلاینت‌ها به اشتراک نمی‌گذارند (و از قبل از وجود کلاینت‌ها مطلع نیستند)، نمی‌توانند پیام‌های ورودی را رمزگشایی کنند. پیام‌های ارسال شده همچنین از forward secrecy پشتیبانی می‌کنند؛ به این معنا که هر پیام با کلید متفاوتی رمزگذاری می‌شود، بنابراین استخراج کلید یک پیام اجازه نمی‌دهد کلید پیام‌های بعدی استخراج شود.

---

## خودمیزبانی (براساس خودمیزبانی واقعی نوشته شود)

- الزامات
- افزودن پلتفرم‌ها
- کلاینت‌ها
- کلاینت‌های Gateway
- پشتیبانی
- بیت‌کوین
- کمک‌های مالی OSS
- Paypal
- مسیرهای ممکن
- اینترنت از طریق SMS
- تمام پیام‌ها از طریق SMS

---

## درس‌های آموخته شده

- **شروع قوی:** ارائه نیازهای فنی پلتفرم بیش از حد زود می‌تواند باعث شود کاربران نظر منفی درباره نرم‌افزار پیدا کنند. این می‌تواند بسیار دشوار باشد که اصلاح شود، زیرا جذب اولیه نقش زیادی در شکل‌گیری نظرات افراد دارد. دانستن اینکه “خیلی زود” یعنی چه نیز بسیار دشوار است و معمولاً ما وقتی “احساس می‌کنیم آماده است” پیش می‌رویم.
- **ایجاد جامعه در اوایل کار:** ارتباط با اعضا درباره توسعه در حال انجام، همه را درگیر نگه می‌دارد و باعث می‌شود مشکلاتی که با آن مواجه می‌شوند بخشوده شود. ما این تجربه را با DekuSMS داشتیم که کانال تلگرامی را زود ایجاد کرد و شروع به ارتباط با اعضا درباره توسعه و ویژگی‌های پیش رو کرد. کاربران مشکلات خود را به اشتراک می‌گذاشتند و دنبال به‌روزرسانی‌ها بودند – اما حتی اگر نرم‌افزار آماده نبود یا باگ داشت، افراد به جامعه می‌پیوستند.
